import org.gradle.internal.os.OperatingSystem;

plugins {
	id "com.moowork.node" version "1.0.1"
	id 'java'
}

apply from: '../reactor/build.gradle'

task buildGUI(type: Exec) {
	println 'Building using Angular CLI'

	if ( OperatingSystem.current().isWindows() ) {
		commandLine 'cmd', '/c', 'ng', 'build', '--base-href', '/', '--deploy-url', '/'
	} else {
		commandLine 'ng', 'build', '--base-href', '/', '--deploy-url', '/'
	}	
	
}
buildGUI.dependsOn(npm_install)

task dist(type: Zip) {
	from 'build/app' 
	baseName project.name
	version project.version
}
buildGUI.doLast { tasks.dist.execute() }

task testCoverage(type: Exec) {
	println 'Testing with code coverage analysis'

	if ( OperatingSystem.current().isWindows() ) {
		commandLine 'cmd', '/c', 'ng', 'test', '--browser', 'ChromeHeadless', '--watch=false', '/',
	} else {
		commandLine 'ng', 'test', '--watch=false', '--browser', 'ChromeHeadless', '/'
	}

}
testCoverage.dependsOn(npm_install)

build.dependsOn(buildGUI)
build.dependsOn(npm_install)